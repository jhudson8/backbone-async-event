/*!
 * https://github.com/jhudson8/backbone-async-event v0.3.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(n){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(e,t){n(e,t)}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(e){n(e,require("underscore"))}:n(Backbone,_)}(function(n,e){var t=n.sync;n.async=e.extend({},n.Events),n.sync=function(c,i,s){function o(n){var e=s[n];s[n]=function(){var t=arguments;e&&e.apply(this,t);var c=r.indexOf(u);c>=0&&r.splice(c,1);var o="success"===n?[n,i,s]:[n,i,t[1],t[2],s];u.trigger.apply(u,o),o.splice(0,0,"complete"),u.trigger.apply(u,o),0===r.length&&i.trigger("async:load-complete")}}s=s||{};var r=i._pendingAsyncEvents=i._pendingAsyncEvents||[],a=s&&s.event||c,u=e.extend({},n.Events);r.push(u),u.method=c,u.options=s,u.model=i,i.trigger("async",a,u,s),i.trigger("async:"+a,u,s),e.each([n.async,n.asyncHandler],function(n){n&&(n.trigger("async",a,i,u,s),n.trigger("async:"+a,i,u,s))}),o("success"),o("error");var f=s.intercept;if(f){if("function"==typeof f)return f(s);throw"intercept must be function(options)"}t.call(this,c,i,s)},e.each([n.Model,n.Collection],function(n){n.prototype.isLoading=function(){return this._pendingAsyncEvents&&this._pendingAsyncEvents.length>0?this._pendingAsyncEvents:!1},n.prototype.hasBeenFetched=function(){return this._fetched}}),n.async.on("async:read",function(n,e){e.on("success",function(){n._fetched=!0})})});