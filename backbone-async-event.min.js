/*!
 * https://github.com/jhudson8/backbone-async-event v0.2.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(n){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(e,t){n(e,t)}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(e){n(e,require("underscore"))}:n(Backbone,_)}(function(n,e){var t=n.sync;n.sync=function(i,r,c){function s(n){var e=c[n];c[n]=function(){var t=arguments;e&&e.apply(this,t);var i=o.indexOf(p);i>=0&&o.splice(i,1);var s="success"===n?[n,r,c]:[n,r,t[1],t[2],c];p.trigger.apply(p,s),s.splice(0,0,"complete"),p.trigger.apply(p,s),0===o.length&&r.trigger("async:load-complete")}}c=c||{};var o=r._pendingAsyncEvents=r._pendingAsyncEvents||[],a=c&&c.event||i,p=e.extend({},n.Events);o.push(p),p.method=i,p.options=c,p.model=r,r.trigger("async",a,p,c),r.trigger("async:"+a,p,c),n.asyncHandler&&(n.asyncHandler.trigger("async",a,r,p,c),n.asyncHandler.trigger("async:"+a,r,p,c)),s("success"),s("error");var d=c.intercept;if(d){if("function"==typeof d)return d(c);throw"intercept must be function(options)"}t.call(this,i,r,c)},e.each([n.Model,n.Collection],function(n){n.prototype.isLoading=function(){return this._pendingAsyncEvents&&this._pendingAsyncEvents.length>0?this._pendingAsyncEvents:!1}})});