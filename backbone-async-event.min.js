/*!
 * https://github.com/jhudson8/backbone-async-event v0.4.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(t,r){e(t,r)}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(t){e(t,require("underscore"))}:e(Backbone,_)}(function(e,t){function r(e){e=e||"_all";var t=d[e];return t||(t=function(t,r){"_all"!==e&&(options=r,r=t,t=e),n(this,r.model,r.options,r.method)},d[e]=t),t}function n(r,n,a,l){function d(e){var t=a[e];a[e]=function(u,a,c){if(e!==f||v.stop||(v.trigger("data",u,a,c,v),u=v.response||u,!v.stop)){t&&t.call(this,u,a,c);var s=h.indexOf(v);s>=0&&h.splice(s,1),0===h.length&&(r[i]=void 0,r.trigger(o));var l=e===f?[e,n,v]:[e,n,u,a,c,v];v.trigger.apply(v,l),l.splice(0,0,"complete"),v.trigger.apply(v,l)}}}var h=r[i]=r[i]||[],p=a&&a.event||l,v=t.extend({},e.Events);v.method=l,v.options=a,v.model=n,h.push(v);var g=u+":"+p;return r.trigger(u,p,v),r.trigger(g,v),r===n&&(c.trigger(u,p,r,v),c.trigger(g,r,v)),d(f),d(s),v}var o=e.xhrCompleteEventName=e.xhrCompleteEventName||"xhr:complete",i=e.xhrModelLoadingAttribute=e.xhrModelLoadingAttribute||"_xhrLoading",u=e.xhrEventName=e.xhrEventName||"xhr",a=e.xhrGlobalAttribute=e.xhrGlobalAttribute||"xhrEvents",c=e[a]=t.extend({},e.Events),f="success",s="error",l=e.sync;e.sync=function(e,r,o){o=o||{},o.url||(o.url=t.result(r,"url"));var i=n(r,r,o,e),u=i.intercept;if(u){if(t.isFunction(u))return u(o);throw"intercept must be function(options)"}return i.xhr=l.call(this,e,r,o),i.xhr},c.on(u+":read",function(e,t){t.on(f,function(){e.hasBeenFetched=!0,e.hadFetchError=!1}),t.on(s,function(){e.hadFetchError=!0})}),e.forwardXhrEvents=function(e,n,o){var i=r(!t.isFunction(o)&&o);if(t.isFunction(o))try{e.on(u,i,n),o.call(this)}finally{e.off(u,i,n)}else{var a=o?u+":"+o:u;e.on(a,i,n)}},e.stopXhrForwarding=function(e,t,n){var o=r(n);e.off(u,o,t)};var d={}});