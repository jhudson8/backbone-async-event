/*!
 * https://github.com/jhudson8/backbone-xhr-events v0.6.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(r,t){e(r,t)}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(r){e(r,require("underscore"))}:e(Backbone,_)}(function(e,r){function t(e){e=e||"_all";var r=h[e];return r||(r=function(r,t){"_all"!==e&&(options=t,t=r,r=e),n(this,t.model,t.options,t.method)},h[e]=r),r}function n(t,n,c,s){function h(e){var r=c[e];c[e]=function(u,c,a){if(e!==f||v.stop||(v.trigger("data",u,c,a,v),u=v.response||u,!v.preventDefault)){r&&r.call(this,u,c,a);var l=d.indexOf(v);l>=0&&d.splice(l,1),0===d.length&&(t[i]=void 0,t.trigger(o,v));var s=e===f?[e,n,v]:[e,n,u,c,a,v];v.trigger.apply(v,s),s.splice(0,0,"complete"),v.trigger.apply(v,s)}}}var d=t[i]=t[i]||[],p=c&&c.event||s,v=r.extend({},e.Events);v.method=s,v.options=c,v.model=n,d.push(v);var g=u+":"+p;return t.trigger(u,p,v),t.trigger(g,v),t===n&&(a.trigger(u,p,t,v),a.trigger(g,t,v)),h(f),h(l),v}var o=e.xhrCompleteEventName=e.xhrCompleteEventName||"xhr:complete",i=e.xhrModelLoadingAttribute=e.xhrModelLoadingAttribute||"xhrActivity",u=e.xhrEventName=e.xhrEventName||"xhr",c=e.xhrGlobalAttribute=e.xhrGlobalAttribute||"xhrEvents",a=e[c]=r.extend({},e.Events),f="success",l="error",s=e.sync;e.sync=function(e,t,o){o=o||{},o.url||(o.url=r.result(t,"url"));var i=n(t,t,o,e),u=i.intercept;if(u){if(r.isFunction(u))return u(o);throw new Error("intercept must be function(options)")}return i.xhr=s.call(this,e,t,o),i.xhr},a.on(u+":read",function(e,r){r.on(f,function(){e.hasBeenFetched=!0,e.hadFetchError=!1}),r.on(l,function(){e.hadFetchError=!0})}),e.forwardXhrEvents=function(e,n,o){var i=t(!r.isFunction(o)&&o);if(r.isFunction(o))try{e.on(u,i,n),o.call(this)}finally{e.off(u,i,n)}else{var c=o?u+":"+o:u;e.on(c,i,n)}},e.stopXhrForwarding=function(e,r,n){var o=t(n);e.off(u,o,r)};var h={}});