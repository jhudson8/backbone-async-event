/*!
 * https://github.com/jhudson8/backbone-xhr-events v0.7.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(r,t){e(r,t)}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(r){e(r,require("underscore"))}:e(Backbone,_)}(function(e,r){function t(e){e=e||"_all";var r=d[e];return r||(r=function(r,t){"_all"!==e&&(options=t,t=r,r=e),n(this,t.model,t.options,t.method)},d[e]=r),r}function n(t,n,c,l){function d(e){var r=c[e];c[e]=function(u,c,a){if(e!==f||p.preventDefault||(p.trigger("data",u,c,a,p),u=p.response||u,!p.preventDefault)){r&&r.call(this,u,c,a);var s=h.indexOf(p);s>=0&&h.splice(s,1),0===h.length&&(t[i]=void 0,t.trigger(o,p));var l=e===f?[e,n,p]:[e,n,u,c,a,p];p.trigger.apply(p,l),l.splice(0,0,"complete"),p.trigger.apply(p,l)}}}var h=t[i]=t[i]||[],v=c&&c.event||l,p=r.extend({},e.Events);p.method=l,p.options=c,p.model=n,h.push(p);var g=u+":"+v;t.trigger(u,v,p),t.trigger(g,p),t===n&&(a.trigger(u,v,t,p),a.trigger(g,t,p));var x=c.beforeSend;return c.beforeSend=function(e,r){if(p.xhr=e,p.settings=r,x){var t=x.call(this,e,r);if(t===!1)return t}return p.trigger("before-send",e,r,p),p.preventDefault?!1:void 0},d(f),d(s),p}var o=e.xhrCompleteEventName=e.xhrCompleteEventName||"xhr:complete",i=e.xhrModelLoadingAttribute=e.xhrModelLoadingAttribute||"xhrActivity",u=e.xhrEventName=e.xhrEventName||"xhr",c=e.xhrGlobalAttribute=e.xhrGlobalAttribute||"xhrEvents",a=e[c]=r.extend({},e.Events),f="success",s="error",l=e.sync;e.sync=function(e,t,o){o=o||{},o.url||(o.url=r.result(t,"url"));var i=n(t,t,o,e);return i.preventDefault?void 0:l.call(this,e,t,o)},a.on(u+":read",function(e,r){r.on(f,function(){e.hasBeenFetched=!0,e.hadFetchError=!1}),r.on(s,function(){e.hadFetchError=!0})}),e.Model.prototype.whenFetched=e.Collection.whenFetched=function(e,t){if(this.hasBeenFetched)return e(this);var n=r.find(this[i],function(e){return"read"===e.method});n?(n.on("success",e),t&&n.on("error",t)):this.fetch({success:e,error:t})},e.forwardXhrEvents=function(e,n,o){var i=t(!r.isFunction(o)&&o);if(r.isFunction(o))try{e.on(u,i,n),o.call(this)}finally{e.off(u,i,n)}else{var c=o?u+":"+o:u;e.on(c,i,n)}},e.stopXhrForwarding=function(e,r,n){var o=t(n);e.off(u,o,r)};var d={}});