/*!
 * https://github.com/jhudson8/backbone-xhr-events v0.9.0;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=e:e(Backbone,_)}(function(e,t){function r(e){e=e||"_all";var t=d[e];return t||(t=function(t,r){"_all"!==e&&(options=r,r=t,t=e),n(r.method,this,r.model,r.options)},d[e]=t),t}function n(e,t,r,n){function f(e){var r=n[e];n[e]=function(n,a,f){if(e!==s||v.preventDefault||(v.trigger("after-send",n,a,f,e,v),n=v.data||n,!v.preventDefault)){try{r&&r.call(this,n,a,f)}finally{var h=l.indexOf(v);h>=0&&l.splice(h,1),0===l.length&&(t[o]=void 0,t.trigger(i,v))}var u=e===s?[e,v]:[e,n,a,f,v];v.trigger.apply(v,u),u.splice(0,0,"complete"),v.trigger.apply(v,u)}}}var l=t[o]=t[o]||[],d=n&&n.event||e,v=new c(e,r,n),p=a+":"+d;t.trigger(a,d,v),t.trigger(p,v),t===r&&(h.trigger(a,d,t,v),h.trigger(p,t,v));var g=n.beforeSend;return n.beforeSend=function(e,t){if(v.xhr=e,v.settings=t,g){var r=g.call(this,e,t);if(r===!1)return r}return v.trigger("before-send",e,t,v),v.preventDefault?!1:void l.push(v)},f(s),f(u),v}var i=e.xhrCompleteEventName=e.xhrCompleteEventName||"xhr:complete",o=e.xhrModelLoadingAttribute=e.xhrModelLoadingAttribute||"xhrActivity",a=e.xhrEventName=e.xhrEventName||"xhr",f=e.xhrGlobalAttribute=e.xhrGlobalAttribute||"xhrEvents",h=e[f]=t.extend({},e.Events),s="success",u="error",c=function(e,t,r){this.method=e,this.model=t,this.options=r};c.prototype.abort=function(){this.aborted||(this.aborted=!0,this.preventDefault=!0,this.xhr&&this.xhr.abort())},t.extend(c.prototype,e.Events);var l=e.sync;e.sync=function(e,r,i){i=i||{},i.url||(i.url=t.result(r,"url"));var o=n(e,r,r,i);if(!o.preventDefault){var a=l.call(this,e,r,i);return o.xhr=a,a}},h.on(a+":read",function(e,t){t.on(s,function(){e.hasBeenFetched=!0,e.hadFetchError=!1}),t.on(u,function(){e.hadFetchError=!0})}),e.Model.prototype.whenFetched=e.Collection.whenFetched=function(e,r){function n(){e(i)}var i=this;if(this.hasBeenFetched)return e(this);var a=t.find(this[o],function(e){return"read"===e.method});a?(a.on("success",n),r&&a.on("error",r)):this.fetch({success:n,error:r})},e.forwardXhrEvents=function(e,n,i){var o=r(!t.isFunction(i)&&i);if(t.isFunction(i))try{e.on(a,o,n),i.call(this)}finally{e.off(a,o,n)}else{var f=i?a+":"+i:a;e.on(f,o,n)}},e.stopXhrForwarding=function(e,t,n){var i=r(n);e.off(a,i,t)};var d={}});